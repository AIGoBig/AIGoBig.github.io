---
layout: post
comments: true
mathjax: false
subtitle: '强化学习'
author: "Sun"
header-style: text
tags:
  - RL
  - 
  - 
---

# 理论

## 强化学习

1. 分数导向性, 分数类似于监督学习的标签
2.  分类
   ![image-20201009171448002](/img/in-post/20_07/image-20201009171448002.png)
   1. 理解环境/不理解环境
   2. 基于概率/基于价值 -> ==Actor-Critic==
      ![image-20201009171811759](/img/in-post/20_07/image-20201009171811759.png)
   3. ==回合更新/单步更新==
      ![image-20201009172019366](/img/in-post/20_07/image-20201009172019366.png)
      ![image-20201009172125347](/img/in-post/20_07/image-20201009172125347.png)
   4. 在线学习/离线学习
      ![image-20201009172241594](/img/in-post/20_07/image-20201009172241594.png)
      ![image-20201009172255551](/img/in-post/20_07/image-20201009172255551.png)



## 介绍

1. 模拟环境编写: tkinter/gym
2. 

# Q-Learning

![image-20201009173557136](/img/in-post/20_07/image-20201009173557136.png)
$$
Q(s,a) <-Q(s,a)+α[r+γmax_{a^{'}}Q(s',a')-Q(s,a)]
$$

> Q现实 = 当前奖励 + 衰减*最大的Q估计
>
> ε-greedy: 一种学习策略,用ε概率(如90%)按照Q表最优值选择
>
> α: 学习效率
>
> γ: 衰减系数, 越大越有远见
>
> ![image-20201009181946022](/img/in-post/20_07/image-20201009181946022.png)

# 实例1/2 — 走迷宫

# sarsa

1. 比较保守



# 实例 —  Goddard Rocket

最大化垂直发射的火箭的最终高度，使用推力作为控制，并给出火箭的初始质量、燃料质量和阻力



## Formulation

这是动态优化中的一个经典问题，是单弧控制问题的典型 See Bryson [[8](https://www.mcs.anl.gov/~more/cops/bcops/node21.html#AEB99), pages 392-394] for background information. 火箭运动方程:
$$
h' = v, \qquad
v' = \frac{T-D(h,v)}{m}-g(h) , \qquad
m' = -\frac{T}{c} ,
$$


其中 $h $ 是来自地球中心的高度，$v $ 是垂直速度，$T $是火箭推力，$D $是空气动力学阻力，$g $ 是引力，$c $ 是测量火箭燃料脉冲的常数。推力必须满足:
![egin{displaymath} 0 \le T ( t ) \le T_{\max} . \end{displaymath}](/img/in-post/20_07/img628-20201013220849830.gif)



The drag and the gravitational force are defined by



![\begin{displaymath} D(h,v) = D_c v^2 \exp \left ( - h_c \left ( \frac{h - h(0)}{... ...ght ) , \qquad g (h) = g_0 \left ( \frac{h(0)}{h} \right )^2 , \end{displaymath}](/img/in-post/20_07/img629.gif)



其中$D_c$和${h_c}$是常数，$g_0$是地球表面的引力。火箭最初处于休息状态（$v（0）=0$），飞行结束时的质量只是初始质量的一小部分

![\begin{displaymath} m ( t_f ) = m_c m(0) , \end{displaymath}](/img/in-post/20_07/img634.gif)

其中 $ t_f $ 是飞行时间和 $ m_c $ 是一个常数。除了推力上的界限外，还有在火箭的质量，高度和速度的如下界限。这些边界是运动方程的直接结果。

![\begin{displaymath} m(t_f) \le m(t) \le m(0) , \qquad h(t) \ge h(0), \qquad v(t) \ge 0 , \end{displaymath}](/img/in-post/20_07/img637.gif)



运动方程可以通过缩放方程和选择模型参数（ $h （0） $、m（0） 和 $g_0 $）来使运动方程具有维度。我们按照 [[8](https://www.mcs.anl.gov/~more/cops/bcops/node21.html#AEB99)]  和使用

![\begin{displaymath} T_{\max} = 3.5 \, g_0 m(0) , \qquad D_c = {\textstyle{\frac{... ...} , \qquad c = {\textstyle{\frac{1}{2}}}( g_0 h(0) ) ^ {1/2}. \end{displaymath}](https://www.mcs.anl.gov/~more/cops/bcops/img641.gif)



有了这些选择，我们可以假设，不失去普遍性， that ![$ h (0) = m(0) = g_0 = 1 $](/img/in-post/20_07/img642.gif). We also follow [[8](https://www.mcs.anl.gov/~more/cops/bcops/node21.html#AEB99)] and choose



![\begin{displaymath} h_c = 500, \qquad m_c = 0.6, \qquad v_c = 620 . \end{displaymath}](/img/in-post/20_07/img643.gif)





We discretize the equations of motion with the trapezoidal rule(梯形法则), and a uniform mesh with $n_h$intervals. Data for this problem appears in Table [10.1](https://www.mcs.anl.gov/~more/cops/bcops/rocket.html#rocket:data).

戈达德火箭问题数据

| Variables                                                    | ![\( 4 (n_h+1) + 1 \)](/img/in-post/20_07/img645.gif) |
| ------------------------------------------------------------ | ----------------------------------------------------- |
| Constraints                                                  | ![\( 3 n_h \)](/img/in-post/20_07/img646.gif)         |
| Bounds                                                       | ![\( 3 ( n_h+1 ) \)](/img/in-post/20_07/img647.gif)   |
| Linear equality constraints                                  | 0                                                     |
| Linear inequality constraints                                | 0                                                     |
| Nonlinear equality constraints                               | ![\( 3 n_h\)](/img/in-post/20_07/img648.gif)          |
| Nonlinear inequality constraints                             | 0                                                     |
| Nonzeros in ![\( \nabla ^{2}f(x) \)](/img/in-post/20_07/img649.gif) | 0                                                     |
| Nonzeros in ![\( c'(x) \)](/img/in-post/20_07/img650.gif)    | ![\( 21 n_h \)](/img/in-post/20_07/img651.gif)        |





## Performance

Results for the AMPL implementation are shown in Table [10.2](https://www.mcs.anl.gov/~more/cops/bcops/rocket.html#rocket:solvers). For starting points we use $  t_f = 1 $and the functions $ h = 1 $,

![\begin{displaymath} v(t) = \frac{t}{t_f} \left ( 1 - \frac{t}{t_f} \right ) , \qquad m(t) = (m_f - m_0 ) \left ( \frac{t}{t_f} \right ) + m_0 , \end{displaymath}](/img/in-post/20_07/img654.gif)

evaluated at the grid points. The initial value for the thrust(推力) is $ T = T_{\max}/2 $.

For the rocket problem with $n_h = 200,\ 400$, ==MINOS== makes no progress, declaring it to be an *unbounded (or badly scaled) problem*.

| Solver                                                       | ![$n_h=50$](/img/in-post/20_07/img657.gif)   | ![$n_h=100$](/img/in-post/20_07/img658.gif)  | ![$n_h=200$](/img/in-post/20_07/img659.gif)            | ![$n_h=400$](/img/in-post/20_07/img660.gif)            |
| ------------------------------------------------------------ | -------------------------------------------- | -------------------------------------------- | ------------------------------------------------------ | ------------------------------------------------------ |
| LANCELOT                                                     | ![$\ddagger$](/img/in-post/20_07/img661.gif) | ![$\ddagger$](/img/in-post/20_07/img662.gif) | ![$\ddagger$](/img/in-post/20_07/img663.gif)           | ![$\ddagger$](/img/in-post/20_07/img664.gif)           |
| ![$f$](/img/in-post/20_07/img665.gif)                        | ![$\ddagger$](/img/in-post/20_07/img666.gif) | ![$\ddagger$](/img/in-post/20_07/img667.gif) | ![$\ddagger$](/img/in-post/20_07/img668.gif)           | ![$\ddagger$](/img/in-post/20_07/img669.gif)           |
| ![$c$](/img/in-post/20_07/img670.gif) violation              | ![$\ddagger$](/img/in-post/20_07/img671.gif) | ![$\ddagger$](/img/in-post/20_07/img672.gif) | ![$\ddagger$](/img/in-post/20_07/img673.gif)           | ![$\ddagger$](/img/in-post/20_07/img674.gif)           |
| iterations                                                   | ![$\ddagger$](/img/in-post/20_07/img675.gif) | ![$\ddagger$](/img/in-post/20_07/img676.gif) | ![$\ddagger$](/img/in-post/20_07/img677.gif)           | ![$\ddagger$](/img/in-post/20_07/img678.gif)           |
| LOQO                                                         | 3.34 s                                       | 3.38 s                                       | 4.65 s                                                 | 12.42 s                                                |
| ![$f$](/img/in-post/20_07/img679.gif)                        | 1.01281e+00                                  | 1.01283e+00                                  | 1.01283e+00                                            | 1.01283e+00                                            |
| ![$c$](/img/in-post/20_07/img680.gif) violation              | 2.1e-10                                      | 4.5e-10                                      | 8.2e-10                                                | 7.5e-10                                                |
| iterations                                                   | 123                                          | 64                                           | 43                                                     | 48                                                     |
| MINOS                                                        | 1.69 s                                       | 4.48 s                                       | 1.12 s                                                 | 3.93 s                                                 |
| ![$f$](/img/in-post/20_07/img681.gif)                        | 1.01280e+00                                  | 1.01278e+00                                  | 9.85326e+03![$\dagger$](/img/in-post/20_07/img682.gif) | 6.11246e+03![$\dagger$](/img/in-post/20_07/img683.gif) |
| ![$c$](/img/in-post/20_07/img684.gif) violation              | 4.8e-13                                      | 6.1e-16                                      | 3.6e+03![$\dagger$](/img/in-post/20_07/img685.gif)     | 1.1e+03![$\dagger$](/img/in-post/20_07/img686.gif)     |
| iterations                                                   | 11                                           | 11                                           | 2                                                      | 2                                                      |
| SNOPT                                                        | 3.04 s                                       | 9.5 s                                        | 31.5 s                                                 | 64.48 s                                                |
| ![$f$](/img/in-post/20_07/img687.gif)                        | 1.01281e+00                                  | 1.01280e+00                                  | 1.01281e+00                                            | 1.01238e+00                                            |
| ![$c$](/img/in-post/20_07/img688.gif) violation              | 1.9e-09                                      | 4.1e-08                                      | 3.5e-09                                                | 5.2e-07                                                |
| iterations                                                   | 37                                           | 29                                           | 43                                                     | 39                                                     |
| ![$\dagger$](/img/in-post/20_07/img689.gif) Errors or warnings. ![$\ddagger$](/img/in-post/20_07/img690.gif) Timed out. |                                              |                                              |                                                        |                                                        |



Figure [10.1](https://www.mcs.anl.gov/~more/cops/bcops/rocket.html#rocket_graph) shows the altitude and mass of the rocket as a function of time. Note that altitude increases until a maximum altitude of $ h = 1.01 $ is reached, while the mass of the rocket steadily decreases until the final mass of  $ m(t_f) = 0.6 $is reached at .$ t = 0.073 $

Figure [10.2](https://www.mcs.anl.gov/~more/cops/bcops/rocket.html#rocket_graph2) shows the velocity and thrust as a function of time. The thrust is bang-singular-bang, with the region of singularity occurring when



![\begin{displaymath} 0 < T(t) < T_{\max} . \end{displaymath}](/img/in-post/20_07/img694.gif)





This figure shows that the optimal flight path involves using maximal thrust until ![$ t = 0.022 $](/img/in-post/20_07/img695.gif), and no thrust for ![$ t \ge 0.073 $](/img/in-post/20_07/img696.gif), at which point the final mass is reached, and the rocket coasts to its maximal altitude. The oscillations that appear at the point of discontinuity in the thrust parameter can be removed by using more grid points.





![\includegraphics[width=2.5in]{ps/rocket_h.eps}](/img/in-post/20_07/img697-20201013220605415.gif) ![\includegraphics[width=2.5in]{ps/rocket_m.eps}](/img/in-post/20_07/img698-20201013220605768.gif)









![\includegraphics[width=2.5in]{ps/rocket_v.eps}](/img/in-post/20_07/img699-20201013220605763.gif) ![\includegraphics[width=2.5in]{ps/rocket_c.eps}](/img/in-post/20_07/img700-20201013220605766.gif)









