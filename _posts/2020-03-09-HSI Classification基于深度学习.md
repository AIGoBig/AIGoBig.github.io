[基于深度学习的高光谱图像分类](https://luozm.github.io/hsi-classification)

## Deep learning for remote sensing data (Review)

Deep learning for remote sensing data: A technical tutorial on the state of the art[J]. 

IEEE Geoscience and Remote Sensing Magazine, 2016

### 基本框架

![image-20200309114041049](/img/in-post/20_03/image-20200309114041049.png)

流程图包括三个主要组成部分：

1. 输入数据、
2. 核心深度网络
3. 预期的输出数据。

在实践中，**输入输出数据对**依赖于特定的应用。对于**基于像素的分类**，==它们是光谱-空间特征及其特征表示（无监督学习）或标签信息（监督学习）。==

值得注意的是，如果有**充足的**训练样本可用，这样的深度网络就可以使用**有监督的**学习方法。

### 基础算法总结

**深度信念网络（DBNs）** 是深度学习研究的一个重大突破，是用受限玻尔兹曼机（RBMs）在一个无监督的情况下训练每个层。稍后，人们提出了一些基于 **自动编码器（AE）** 的算法，还提出了在每个级别局部训练表示的中间级别（即AE及其变体，例如SAE和DAE）。与AE不同，**稀疏编码算法** 通过自分解学习超完备字典，从不同的角度生成数据本身的稀疏表示。此外，作为最具代表性的有监督深度学习模型，**卷积神经网络（CNN）** 在视觉识别中的表现优于大多数算法。CNN的深层结构允许模型学习高度抽象的特征检测器，并将输入特征映射到能够明显提高后续分类器性能的表示。

### 具体应用

#### 图像预处理

根据相关的遥感文献，大多数现有的遥感图像去噪、去模糊、超分辨率和Pan Sharpening的方法都是基于信号处理中的标准图像处理技术，而基于机器学习的方法很少。实际上，**如果我们能够通过一组训练样本有效地模拟输入（观测数据）和输出（理想数据）之间的内在关联，则可以用同样的模型增强观测到的遥感图像。**

##### ==恢复和去噪?????==

对于遥感图像恢复和去噪，使用干净的图像训练网络模型，将原始图像输入到训练好的网络中获得恢复和去噪的图像。经典的反卷积网络模型是基于$L_1$正则化的图像卷积分解，其中$L_1$正则化是稀疏约束。在本研究进行的实验中，在深度网络中采用$L_1$正则化，给出了比$L_1$更稀疏的解, 并取得了满意的效果.

##### Pan Sharpening

#### 基于像素的分类

近年来，**传统方法**在手工特征描述、判别特征学习，分类器设计方面取得了显著进展。然而，从深度学习的角度来看，大多数现有方法只能提取原始数据的**浅层特征**，对于分类任务不够健壮。

基于深度学习的遥感图像像素分类涉及到**构建一个面向像素级的数据表示和分类的深度网络结构**。采用深度学习技术，可以提取**更健壮和抽象的**特征表示，从而提高分类精度。

遥感图像**像素级分类**的方案包括三个主要步骤:

1. 数据输入
2. 分层深度学习模型训练
3. 分类

![image-20200309141111735](/img/in-post/20_03/image-20200309141111735.png)

在第一步中，**输入向量**可以是光谱特征、空间特征或光谱-空间特征。然后，**对于隐藏层**，设计一个深层网络结构来学习输入数据的特征表示。在相关文献中，==**有监督**的深度学习结构（例如CNN）和**无监督**的深度学习结构（例如AE、DBN和其他在每层中自定义神经元的模型）==。第三步是**分类**，通过在第二步（深度网络的顶层）中利用学习到的特征进行分类。通常，**分类器**主要有两种类型:

1. 硬分类器（如支持向量机），它直接输出整数作为每个样本的类别;
2. 软分类器（如逻辑回归），它可以同时微调整个预训练网络，以概率分布预测类别

##### 光谱特征分类

光谱信息通常含有丰富的判别信息。

对于光谱特征分类，原始图像数据的光谱特征直接作为输入向量。在网络部分训练输入向量，以获得稳健的深度特征表示，作为后续分类步骤的输入。选定的深层网络可以是CNN和AE。特别是林等人采用**AE+SVM和SAE+逻辑回归**作为网络结构和分类层，分别进行浅层和深度表征的分类任务。

##### 结合空间信息的分类

在空间中土地覆盖是连续的，遥感图像中的相邻像素很可能属于同一类。如许多光谱-空间分类研究中所示，利用空间特征可以显著提高分类精度。

然而，传统方法由于其自身的特点，无法提取稳健的深度特征表示。为了解决这个问题，提出了一些基于深度学习的特征学习方法，寻找一种提取深层光谱-空间表示的新方法。

对于原始遥感图像中的某个像素，自然要考虑其邻近像素来提取空间特征表示。然而，由于高光谱图像多达数百个的光谱波段，**区域堆叠的特征向量会导致输入维数过大**。因此，有必要在空间特征表示之前减少光谱特征维数。

==在**第一步**中，通常使用**主成分分析（PCA）**，==以便将数据维数减少到可接受的范围，并降低信息丢失。

然后，在**第二步**中，通过使用原始图像中的每个特定像素的 w×w（w是窗口的大小）邻域来收集空间信息。之后，将空间数据整理为一维向量，以输入深层网络。林等人和陈等人采用SAE作为深层网络结构。学习抽象特征之后，进行最终的分类步骤，类似于光谱分类方案。

在考虑**联合光谱和空间特征提取和分类方案**时，有**两个主要策略**来实现此目标。

1. 直接地，不同于之前的光谱-空间分类方案，**光谱和初始空间特征结合在一起成为一个向量**作为深度学习网络的输入。相关论文选择的深层网络分别是SAE和DBN。然后，通过学习的深层网络，得到各个测试样本的联合光谱-空间特征表示，用于后续的分类任务，该分类任务与前面描述的光谱空间分类方案相同。
2. ==另一种方法是通过**带卷积的深层网络处理某个像素的光谱和空间信息**（例如CNN、CAE和特殊定义的深层网络）。==

此外，还有一些**分层学习框架**，将每一步操作==（例如，特征提取、分类和后处理）作为深层网络中的一层。==

### 结论及展望

我们系统地回顾了遥感数据分析中的前沿技术。深度学习最初起源于机器学习领域，用于分类和识别任务，它们只是最近才出现在地球科学和遥感领域。从图像预处理、基于像素的分类、目标识别和场景理解四个角度，我们发现深度学习在**目标识别**和**场景理解**方面取得了显著的成功，这也正是在最近几十年中被遥感研究群体广泛认为是挑战的领域。因为这些应用要求我们**从底层特征（通常为原始像素表示）提取高层语义信息**，而传统的描述特征提取分类的遥感方法是浅层模型，难以或不可能揭示高层次的特征。

另一方面，在图像预处理和基于像素的分类中（特别是考虑大规模训练集的成本），深度学习的研究成果并不突出。部分原因是图像质量的提高更可能与图像退化模型（与传统方法一样）相关。**在大多数情况下，即使只处理光谱特征，预测遥感图像的像素标签的任务是相对浅层的**。尽管如此，我们坚信深度学习在遥感数据分析中是至关重要的，特别是对于遥感大数据的年龄而言。

然而，关于深度学习的研究仍然年轻，许多问题仍然没有答案。以下是一些遥感数据分析中潜在的有趣话题。

1. **训练样本数量的缺乏**：虽然深度学习方法可以从原始遥感图像中获取高度抽象的特征表示，但是检测和识别性能依赖于**大量的训练样本**。然而，由于收集带标记的高分辨率图像的困难，研究通常缺乏高质量的训练图像。在这种情况下，**如何在较少的训练样本下**保持深度学习方法的表征学习性能仍然是一个很大的挑战。
2. **遥感图像的复杂性**：与自然场景图像不同，高分辨率遥感图像包括不同大小、颜色、方向的物体，同时属于**不同类别的不同场景在许多方面可能相似**。遥感图像的复杂性使得从场景和对象中学习具有健壮性和区分性表示的难度大大增加。
3. ==**数据集之间的传输**：==一个有趣的方向是从深度网络中学习的特征检测器从一个数据集向另一个数据集的传输，因为在某些遥感领域往往缺乏训练图像。特别是面对遥感数据集的巨大变化，问题可能更严重，这需要进一步的系统研究。
4. **深度学习模型的深度**：深度网络越深，这个模型的性能越好。对于有监督的网络（如CNN），更深的层可以学习更复杂的分布。但它们也可能导致有更多的参数需要学习，因此可能导致**过拟合问题**，特别是在**训练样本不足**时。计算时间也是应考虑的一个重要因素。给定数据集上的深度学习模型的**最佳深度仍然是有待研究的课题.**

## 3D CNN（Spectral-Spatial 3D CNN）

Li Y, Zhang H, Shen Q. Spectral–Spatial Classification of Hyperspectral Imagery with 3D Convolutional Neural Network[J]. Remote Sensing, 2017, 9(1): 67.

### 摘要

该方法整体观察HSI立方体数据集，而完全不依赖任何预处理或后期处理，有效地提取了联合光谱-空间特征。此外，它需要的参数比其他基于深度学习的方法更少。因此，该模型更轻，更不容易过拟合，更容易训练。

实验结果表明，基于3D-CNN的方法优于现有的同类方法，并创造了新的记录.

### 原理及算法

#### 2D效果不好的原因

直接将2D-CNN应用于高光谱图像，需要对网络中每个二维输入进行卷积，每一个光谱波段都有一组需学习的核。**沿着HSI的光谱波段（网络输入）的数百个通道需要大量的卷积核（需学习的参数），这可能在增加计算成本的同时也容易过度拟合。**

为了解决这一问题，通常在使用二维神经网络进行特征提取和分类前，采用降维方法对数据进行降维。例如：

- 从HSI提取前三个主成分，然后利用2D-CNN从压缩的HSI数据中提取深度特征，窗口大小为42×42，以预测每个像素的标号。
- 引入了随机PCA（R-PCA），沿着光谱维度以压缩整个HSI数据集，保留前十个或30个主成分。然后使用2D-CNN从压缩的数据中提取深度特征（窗口大小为5×5），最后完成分类任务。
- 另一个方法有三个计算步骤：首先对整个HSI数据集使用PCA算法白化（whitened），只保留几个顶层的波段，接着通过2D-CNN提取高级特征；然后应用稀疏表示进一步降低第一步产生的高级空间特征的维数。最后得到基于学习的稀疏字典的分类结果。

这些方法的一个明显缺点是它们不能很好地保留光谱信息。

为了充分利用深度学习的特点，我们将3D-CNN引入到HSI处理中。3D-CNN使用三位的卷积核来进行三维卷积操作，可以同时提取空间特征和光谱特征。

在基于3D-CNN的分类模型中，每个特征立方体被独立处理。因此在上式中 m=1 ，三维卷积运算可以重新表示为：
$$
v_{lij}^{xyz}=f(\sum_{h=0}^{H_l-1}\sum_{w=0}^{W_l-1}\sum_{d=0}^{D_l-1}k_{lj}^{hwd}v_{(l-1)i}^{(x+h)(y+w)(z+d)}+b_{lj})
$$

> 其中 D_l 是三维核的光谱深度，i 是前一层特征立方体的数目，j 是该层中核的数目，$v_{lij}^{xyz} $是利用前一层第 i 个特征立方体与 l 层第 j 个核卷积计算得到的 (x, y, z) 位置的输出，$k_{lj}^{hwd} $是与前一层第 i 个特征立方体相连接的核的第 (h,w,d) 个值。因此,第 l 卷积层的输出数据包含 i×j 三维特征立方体。



####  Feature Analysis

特征分析对于理解深度学习机制是非常重要的。在本节中，我们说明了3D-CNN模型提取的特征。

### 数据及实验

####  数据集

1. PaviaU：610×340×103（41849），随机50%训练集，50%测试集；
2. Botswana：1476×256×145（3248），随机50%训练集，50%测试集；
3. Indian Pines：145×145×200（10086），随机50%训练集，50%测试集。



### 结论及展望

在未来的研究中，我们计划研究更有效的可以利用无标记样本的基于3D-CNN的分类技术。在HSI数据集中，未标记样本比标记样本更容易获得。基于3D-CNN的监督分类方法不能充分利用这些未标注样本。为了更好地解决这一问题，一种基于3D-CNN的**==整合无监督和半监督的分类方法==**可能更加合适。



## SDAE（Spectral-Spatial Deep Auto-Encoder）

Spectral–spatial classification of hyperspectral image based on deep auto-encoder[J]. IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing, 2016,

### 摘要

本文主要关注如何在HSI分类框架中**提取和利用深层特征**。首先，为了提取光谱-空间信息，本文提出了一种改进的空间更新自编码器（SDAE）。它通过在能量函数中添加一个正则化项来考虑样本的相似度，然后通过整合上下文信息来更新特征。其次，为了解决在小训练集上使用深层特征的问题，应用了一种基于协同表示（Collaborative Representation，CR）的分类方法。接着，为了抑制椒盐噪声（salt-and-pepper noise）并平滑结果，我们计算了所有样本协同表示的残差作为一个残差矩阵，它能够有效的使用在基于图割算法（graph-cut）的空间正则化中。提出的方法继承了深度学习的优势，并提出了在学习网络中增加HSI空间信息的解决方案。使用具有深度特征的协同表示分类使得所提出的分类器在小训练集下非常强大。大量的实验表明，与一些相关技术相比，所提出的方法提供了令人鼓舞的结果。

### 关研究背景

近些年来，许多光谱-空间分类方法被提出。

1. 大部分方法在分类之前提取空间特征，EMAP、tensor-based spectral–spatial features、composite kernels、multiple kernels、learning-based features。这种预处理方式来提取空间信息可以与任意分类器结合。
2. 还有许多光谱-空间分类方法在分类同时利用空间信息，比如MRF、joint sparsity model、simultaneous subspace pursuit、nearest regularized。
3. 有一些光谱-空间分类方法在基于像素的分类之后考虑空间平滑性，比如使用分割图来正则化基于像素的分类结果。

在HSI分类中，特征表示与分类器设计一样重要。在HSI中有三种特征表示类型：

1. 特征选择（FS）：FS基于一些规则在输入数据中寻找一个合适的子集，比如Jeffries-Matusita (J-M) distance、mutual information。
2. 特征提取（FE）：FE开发了一些转换，通常将完整的原始测量转换为新的子空间，比如PCA、minimum noise fraction (MNF)。
3. 混合方法：在特征提取中同时使用FS和FE，比如先基于专家经验选择一些波段，然后在选定的波段上对其进行特征提取。
4. 除了光谱特征和空间特征外，我们还可以获得HSI分类任务的其他信息，甚至可以从其他遥感数据获得一些信息，如高度信息。

可以处理高维度的HSI且促进分类结果的优秀的特征表征方法是必要的。然而，所有这些功能都是人工设计的，它利用了人类的聪明才智和先验知识。一些特征伴随着无法管理的参数，这些参数需要经验丰富的算子的交互。 此外，对于具体应用来说，并非所有特征都有效。成功应用于人工智能的深度学习，能够学习如何通过分层训练过程来表征特征，并可以通过最小化来自不同类的所有样本的均方误差来改进模型。层次结构类似于人类大脑的识别过程，它拥有比硬编码特征表征方法更好的抽象概念的学习能力。

### 原理及算法

首先，我们提出一个有监督的特征提取器：空间更新自编码器（SDAE），来联合利用HSI的光谱和空间特征。SDAE在特征学习阶段考虑邻域信息，最大化类之间的特征差异，这被认为更适合于HSI分类。此外，为了更好地利用深层特征，我们在特征空间中采用了基于协同表示（CR）的分类方法来获得结果。此外，为了抑制椒盐噪声，并平滑结果，我们利用基于协同表示的分类来得到一个残差矩阵，它可以被用于一种基于图割算法的空间正则化方法，该方法在小训练集下具有很强的鲁棒性。

### SDAE

在特征提取中有两个事实需要考虑：（1）相似光谱特征的样本应该大概率的具有相同的类别标签，这是全局约束；（2）具有类似光谱特征的相邻样本也应大概率的拥有相同的类别标签，这是局部约束。

自编码器独立考虑每个样本，仅仅关注输入和重构之间的误差。为了使特征学习结构与全局约束相一致，我们改进DAE来保留样本之间的相关性。

我们通过添加一个由权重控制的相似度正则化项来改进自编码器中的能量函数，使之能够在我们的SDAE中使用。



未完



